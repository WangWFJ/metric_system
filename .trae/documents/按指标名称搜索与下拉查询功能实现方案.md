## 目标

* 在仪表板与上传弹窗中支持“按指标名称搜索”的下拉查询，用户输入关键字即可获得匹配的指标列表并选择。

* 支持根据考核类型筛选后，再按名称搜索该类型下的指标（上传流程）。

## 后端接口

* 新增：GET /api/v1/metrics/indicators/search

  * 参数：

    * q: string（必填，指标名称关键字，支持模糊）

    * type\_id: int（可选，若传则限定在该类型下搜索）

    * size: int（可选，默认 20，最大 100）

  * 返回：List\[IndicatorSimpleOut]（indicator\_id, indicator\_name, indicator\_code）

  * 实现要点：Indicator.status==1，LIKE %q%，按更新时间或名称排序；若传 type\_id 则 where Indicator.type\_id==type\_id。

  * 代码位置：后端路由与服务 [indicators.py](file:///g:/Project/data_proj_v1_trae/app/api/endpoints/indicators.py) 与 [indicator\_service.py](file:///g:/Project/data_proj_v1_trae/app/services/indicator_service.py)

## 前端 API

* 新增函数：getIndicatorSuggestions({ q, type\_id?, size? }) → 调用 /metrics/indicators/search 返回简表列表。

  * 位置：[indicator.ts](file:///g:/Project/data_proj_v1_trae/frontend/src/api/indicator.ts)

## 仪表板筛选区（Dashboard）

* 在筛选表单新增“指标名称”下拉框（远程搜索）：

  * 组件：el-select filterable remote，remote-method 在输入时调用 getIndicatorSuggestions({ q })；选中后将 indicator\_id 写入筛选参数并调用 refresh。

  * 支持清空（clearable）后移除 indicator\_id 筛选。

  * 位置：[Dashboard.vue](file:///g:/Project/data_proj_v1_trae/frontend/src/views/Dashboard.vue)

* 后端查询增加 indicator\_id 筛选已支持；若需按名称直接筛选，则在 query\_metrics 中支持 indicator\_name 模糊匹配（JOIN Indicator + LIKE）。

## 上传弹窗（根据类型再搜索）

* 保持“先选考核类型，再选指标”的逻辑：

  * 指标选择改为远程搜索：用户在“指标名称”下拉输入关键字时，调用 getIndicatorSuggestions({ q, type\_id: uploadForm.type\_id })，仅返回该类型下的匹配指标。

  * 未选择类型时禁用指标下拉。

  * 位置：[Dashboard.vue](file:///g:/Project/data_proj_v1_trae/frontend/src/views/Dashboard.vue)

## 交互与体验

* 输入>=2字符触发搜索；节流/防抖（300ms）防止频繁请求；loading 状态提示。

* 下拉项显示“指标名称（编码）”，选中后存 indicator\_id。

## 验证

* 上传弹窗：选择类型→在指标下拉输入关键字→显示匹配项并可选；提交成功。

* 仪表板：在“指标名称”下拉输入关键字→选择某指标后列表仅显示该指标数据；清空后恢复。

## 备注

* 若优先简化实现，可先在现有 /metrics/indicators\_by\_type 增加 q 参数用于类型内搜索；但全局搜索仍建议新增 /search 接口以保持清晰结构。

