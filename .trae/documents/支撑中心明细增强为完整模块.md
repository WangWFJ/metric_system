## 目标

* 将“支撑中心明细模块”做成与“区县明细”一致的完整功能集：上传、批量上传、修改、删除、明细导出、汇总导出、支撑中心对比、趋势显示。

* 保持支撑中心明细不展示“豁免值/零容忍值”（UI 不显示，但后端字段可保留兼容）。

## 现状复用点

* 区县明细完整交互在 [Dashboard.vue](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/frontend/src/views/Dashboard.vue)（上传/批量上传/编辑/删除/导出/汇总/趋势/对比）。

* 后端区县明细与导入导出在 [indicators.py](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/app/api/endpoints/indicators.py) 与 [indicator\_service.py](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/app/services/indicator_service.py)。

* 支撑中心基础查询已具备：`/metrics/centers`、`/metrics/center`、`/metrics/center/query`。

## 后端实现（补齐支撑中心 CRUD / 导入导出 / 对比 / 趋势）

### 1) 新增中心数据写入/修改/删除接口

* `POST /api/v1/metrics/center/data`：单条录入（类似 `/metrics/data`）

* `POST /api/v1/metrics/center/data/update`：单条修改（类似 `/metrics/data/update`）

* `DELETE /api/v1/metrics/center/data`：按 ids 或过滤条件删除（类似 `/metrics/data`）

* 权限：沿用 `indicator_data:add/edit/delete`（不引入新权限体系，最少改动）。

### 2) 批量上传与模板

* `GET /api/v1/metrics/center/upload/template`：Excel 模板（中文表头包含“支撑中心”“统计日期”“完成值/基准值/挑战值/得分”等；不含豁免/零容忍）

* `POST /api/v1/metrics/center/upload`：批量上传（解析 Excel；校验 indicator 与 center 是否存在；写入 `indicator_center_data`；遇到错误返回前 N 条错误信息）

### 3) 明细导出与汇总导出

* `GET /api/v1/metrics/center/export`：导出当前筛选的中心明细列表（类似 `/metrics/export`）

* `GET /api/v1/metrics/center/export_v2`：汇总导出（按统计日期分 Sheet，行=支撑中心，列=指标；附带区县/中心信息；行顺序按 `center_id`）

### 4) 支撑中心对比（类似区县对比）

* `GET /api/v1/metrics/center/by_name_or_id`：给定 `indicator_id` + `stat_date`（可选）返回“该指标在所有中心的最新/指定日数据”，用于柱状对比；可选支持 `district_id` 过滤。

### 5) 趋势（类似区县趋势）

* `GET /api/v1/metrics/center/series`：参数 `indicator_id` 必填；`center_id` 可选；`start_date/end_date/size` 可选。

* 返回结构沿用 `{items,total}`，items 为中心维度的时序数据。

## 前端实现（将 CenterDashboard 做到与 Dashboard 一致）

### 1) CenterDashboard UI 对齐 Dashboard

* 在 [CenterDashboard.vue](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/frontend/src/views/CenterDashboard.vue) 增加：

  * 顶部按钮：上传、批量上传、导出明细、汇总导出、删除所选（权限控制同 Dashboard）

  * 表格：选择框（批量删除）、操作列（趋势/支撑中心对比/编辑/删除）

  * 编辑弹窗：可编辑完成值/基准值/挑战值（不含豁免/零容忍）

  * 上传弹窗：选择考核类型→指标→区县→支撑中心→日期→完成值等

  * 批量上传 popover：复用 Dashboard 的文件 chip 拖拽 UI

### 2) 新增中心维度 API 封装

* 扩展 [indicator.ts](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/frontend/src/api/indicator.ts)：

  * `createCenterData/updateCenterData/deleteCenterData`

  * `uploadCenterData/getCenterUploadTemplate`

  * `exportCenterMetrics/exportCenterMetricsSummary`

  * `getCenterLatestById`（对比用）

  * `getCenterSeries`（趋势用）

### 3) 趋势组件

* 新增 `CenterIndicatorChart.vue`（参考现有 [IndicatorChart.vue](file:///d:/Users/JUN/Desktop/data_proj_v1_trae（docker）v1/frontend/src/components/IndicatorChart.vue)），但数据源改为 `getCenterSeries`，并支持按 center\_id 展示。

### 4) 支撑中心对比弹窗

* 在 CenterDashboard 中复用 ECharts 弹窗实现（参考 Dashboard 的 `handleCompare`），数据源改为 `getCenterLatestById`。

## 验证方式

* 后端：`python -m compileall app`；用少量 curl 验证新增接口能返回 200/权限生效。

* 前端：`pnpm -C frontend build`；进入 `/center-dashboard` 验证上传/编辑/删除/导出/汇总/对比/趋势流程。

## 交付清单

* 后端新增：中心维度 CRUD、上传/模板、导出/汇总、对比、趋势接口。

* 前端新增：CenterDashboard 与 Dashboard 同等功能按钮与弹窗；新增中心趋势图组件；对比弹窗。

* 保持“支撑中心明细”不展示豁免值/零容忍值（UI 层移除）。

